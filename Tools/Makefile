MKDIR = mkdir -p

TOOLS_SUBPATH = gcc-arm-none-eabi

TOOLS_VERSION_SHORT = 4.8
TOOLS_VERSION_LONG = 4.8-2014-q1-update
TOOLS_VERSION_FILENAME = 4_8-2014q1-20140314
TOOLS_EXPANDED_DIRNAME = gcc-arm-none-eabi-4_8-2014q1

TOOLS_URL_PREFIX = https://launchpad.net/gcc-arm-embedded/$(TOOLS_VERSION_SHORT)/$(TOOLS_VERSION_LONG)/+download/
TOOLS_OSX_TARBALL_FILENAME = gcc-arm-none-eabi-$(TOOLS_VERSION_FILENAME)-mac.tar.bz2
TOOLS_LINUX_TARBALL_FILENAME = gcc-arm-none-eabi-$(TOOLS_VERSION_FILENAME)-linux.tar.bz2
TOOLS_WIN32_ZIP_FILENAME = gcc-arm-none-eabi-$(TOOLS_VERSION_FILENAME)-win32.zip

UNAME := $(shell uname -s)

ifeq (Darwin,$(UNAME))
TOOLS_FILENAME = $(TOOLS_OSX_TARBALL_FILENAME)
DOWNLOAD_TOOL = curl -OL
EXTRACT_TOOL = tar xjf
SYMLINK = ln -s $(TOOLS_EXPANDED_DIRNAME) $(TOOLS_SUBPATH)
else
ifeq (Linux,$(UNAME))
TOOLS_FILENAME = $(TOOLS_LINUX_TARBALL_FILENAME)
DOWNLOAD_TOOL = wget
EXTRACT_TOOL = tar xjf
SYMLINK_COMMAND = ln -s $(TOOLS_EXPANDED_DIRNAME) $(TOOLS_SUBPATH)
else
TOOLS_FILENAME = $(TOOLS_WIN32_ZIP_FILENAME)
DOWNLOAD_TOOL = wget
EXTRACT_TOOL = 7z x -y -o$(TOOLS_EXPANDED_DIRNAME)
# Windows uses cmd.exe; Cygwin uses ln -s
ifeq (windows32,$(UNAME))
SYMLINK_COMMAND = cmd /c "mklink /D $(TOOLS_SUBPATH) $(TOOLS_EXPANDED_DIRNAME)""
else
SYMLINK_COMMAND = ln -s $(TOOLS_EXPANDED_DIRNAME) $(TOOLS_SUBPATH)
endif #Windows and Cygwin
endif #Linux
endif #Darwin

all: $(TOOLS_SUBPATH)

.ONESHELL:
$(TOOLS_SUBPATH): $(TOOLS_EXPANDED_DIRNAME)
	$(SYMLINK_COMMAND)

$(TOOLS_EXPANDED_DIRNAME): $(TOOLS_FILENAME)
	$(EXTRACT_TOOL) $(TOOLS_FILENAME)

$(TOOLS_FILENAME):
	$(DOWNLOAD_TOOL) --no-check-certificate $(TOOLS_URL_PREFIX)$(TOOLS_FILENAME)

.PHONY: clean

clean:
	rm -rf $(TOOLS_EXPANDED_DIRNAME)
	rm $(TOOLS_FILENAME)
	rm $(TOOLS_SUBPATH)
